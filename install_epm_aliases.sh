#!/bin/bash

ZSHRC="$HOME/.zshrc"
BASHRC="$HOME/.bashrc"

# Тело функции epm-help
EPMA_HELP_FUNC=$(cat <<'EOF'
# -------- Алиас для epm --------
# -------- Алиас для epm --------
epm-help() {
  echo
  echo -e "\033[1;33mepm - \033[1;37mПакетный менеджер Etersoft \033[0m"
  echo -e "\033[1;32mИспользование:\033[0m epm {команда} [аргументы]"
  echo

  ##########################
  # 1. Работа с пакетами
  ##########################
  echo -e "\033[1;36m[ Работа с пакетами ]\033[0m"
  printf "┌───────────────────────────────┬────────────────────────────────────────────────────┐\n"
  printf "│ \033[1;33mКоманда epm\033[0m                   │ \033[1;37mОписание\033[0m                                           │\n"
  printf "├───────────────────────────────┼────────────────────────────────────────────────────┤\n"
  printf "│ \033[1;33mepm -i\033[0m <pkg>                  │ Установка пакета из репозитория                    │\n"
  printf "│ \033[1;33mepm -i\033[0m <file>                 │ Установка пакета из файла                          │\n"
  printf "│ \033[1;33mepm -e\033[0m <pkg>                  │ Удаление пакета                                    │\n"
  printf "│ \033[1;33mepm -s\033[0m <text>                 │ Поиск пакета в репозитории                         │\n"
  printf "│ \033[1;33mepm -q\033[0m <pkg>                  │ Проверка, установлен ли пакет                      │\n"
  printf "│ \033[1;33mepm -qa\033[0m                       │ Список всех установленных пакетов                  │\n"
  printf "│ \033[1;33mepm -qp\033[0m <word>                │ Поиск по названиям установленных пакетов           │\n"
  printf "│ \033[1;33mepm -qf\033[0m <file>                │ Какому пакету принадлежит файл                     │\n"
  printf "│ \033[1;33mepm -sf\033[0m <file>                │ В каком пакете содержится указанный файл           │\n"
  printf "│ \033[1;33mepm -ql\033[0m <pkg>                 │ Список файлов в установленном пакете               │\n"
  printf "│ \033[1;33mepm -qi\033[0m <pkg>                 │ Информация о пакете                                │\n"
  printf "│ \033[1;33mepm repack\033[0m <pkg>              │ Перепаковка установленного пакета                  │\n"
  printf "└───────────────────────────────┴────────────────────────────────────────────────────┘\n"
  echo

  ##########################
  # 2. Работа с системой
  ##########################
  echo -e "\033[1;36m[ Работа с системой ]\033[0m"
  printf "┌───────────────────────────────┬────────────────────────────────────────────────────┐\n"
  printf "│ \033[1;33mКоманда epm\033[0m                   │ \033[1;37mОписание\033[0m                                           │\n"
  printf "├───────────────────────────────┼────────────────────────────────────────────────────┤\n"
  printf "│ \033[1;33mepm update\033[0m                    │ Обновить список доступных пакетов                  │\n"
  printf "│ \033[1;33mepm upgrade\033[0m                   │ Обновление дистрибутива (без ядра)                 │\n"
  printf "│ \033[1;33mepm full-upgrade\033[0m              │ Полное обновление системы (включая ядро)           │\n"
  printf "│ \033[1;33mepm ei\033[0m                        │ Обновление утилиты epm                             │\n"
  printf "└───────────────────────────────┴────────────────────────────────────────────────────┘\n"
  echo

  ##########################
  # 3. epm play (приложения)
  ##########################
  echo -e "\033[1;36m[ Работа с приложениями (epm play) ]\033[0m"
  printf "┌───────────────────────────────┬────────────────────────────────────────────────────┐\n"
  printf "│ \033[1;33mКоманда epm play\033[0m              │ \033[1;37mОписание\033[0m                                           │\n"
  printf "├───────────────────────────────┼────────────────────────────────────────────────────┤\n"
  printf "│ \033[1;33mepm play\033[0m                      │ Список доступных к установке приложений            │\n"
  printf "│ \033[1;33mepm play\033[0m <pkg>                │ Установка указанного приложения                    │\n"
  printf "│ \033[1;33mepm play --update all\033[0m         │ Обновить программы, установленные через epm play   │\n"
  printf "│ \033[1;33mepm play --installed\033[0m <word>   │ Проверка, установлено ли приложение                │\n"
  printf "└───────────────────────────────┴────────────────────────────────────────────────────┘\n"

  echo
}
EOF
)

add_to_file() {
  local file="$1"

  # Проверка, есть ли уже функция
  if grep -q "epm-help()" "$file"; then
    echo "[INFO] epm-help уже добавлен в $file"
  else
    echo -e "\n# Добавлено install_epm_aliases.sh" >> "$file"
    echo "$EPMA_HELP_FUNC" >> "$file"
    echo "[OK] Добавлено в $file"
  fi
}

# Добавим в оба файла
add_to_file "$ZSHRC"
add_to_file "$BASHRC"

echo
echo "Готово! Перезапусти терминал или выполни:"
echo "source ~/.zshrc"

